## 系统管理
### 进程管理
进程是正在执行的一个程序或命令，每一个进程都是一个运行的实体，都有自己的地址空间，并占用一定的系统资源

进程管理的作用：
- 判断服务器健康状态
- 查看系统中所有进程
- 杀死进程

#### 查看系统进程
查看系统进程的命令有 ```ps aux``` 和 ```ps -ef``` 两种，二者的区别在于显示的内容有些不同。aux 方式显示时会截断 comman 列，因此推荐使用 ```ps -ef```。

使用 ```ps -ef``` 显示的列：
- ```UID```：启动进程的用户 ID，实际是用户名
- ```PID```：进程 ID
- ```PPID```：父进程 ID
- ```C```：进程占用的 CPU 百分比
- ```STIME```：进程启动的时间
- ```TTY```：进程运行的终端，若和终端无关则显示 ?
- ```CMD```：启动进程的命令和命令的参数
- ```TIME```：进程从启动到现在占用的 CPU 时间

使用 ```ps aux``` 显示的列：
- ```USER```：启动进程的用户名
- ```PID```：进程 ID
- ```%CPU```：进程占用的 CPU 资源百分比
- ```%MEM```：进程占用的内存资源百分比
- ```VSZ```：进程占用的虚拟内存大小，单位 KB
- ```RSS```：进程占用实际物理内存的大小，单位 KB
- ```TTY```：进程是运行的终端，其中 tty1~tty7 代表本地控制台终端，pts/0-255 代表虚拟终端
- ```STAT```：进程状态，常见的状态有：R(运行) S(睡眠) T(停止) s(包含子进程) +(位于后台)
- ```START```：程的启动时间
- ```TIME```：进程从启动到现在占用的 CPU 时间
- ```COMMAND``` ：启动进程的命令

#### 查看进程资源
查看系统状态使用 ```top``` 命令，间隔性的输出系统的健康状态，使用 ```-d``` 选项可以指定刷新的频率，默认是 3s。
```shell
top -d 5
```
```top``` 命令的输出分为两部分，第一部分显示了系统的资源情况，每一行表示一种系统资源的情况；第二部分显示了各进程占用的系统资源情况，每一行表示每个进程占用的资源情况：
- 系统负载信息：当前时间、系统运行时长、系统当前用户数、系统(1 分钟，5 分钟， 15 分钟内)的平均负载
- 系统进程信息：进程总数(total)、正在运行进程数(running)、睡眠进程数(sleeping)、停止的进程数(stopped)、僵尸进程数(zombie，需要手动杀掉)
- CPU 信息：用户进程占用的 CPU 百分比(us)、系统进程占用的 CPU 百分比(sy)、改变过优先级的用户进程占用的 CPU 百分比(ni)、空闲 CPU 的 CPU 百分比(id)、等待输入/输出的进程的占用 CPU 百分比(wa)、硬中断请求服务占用的 CPU 百分比(si)、虚拟时间百分比(st，当有虚拟机时，虚拟 CPU 等待实际 CPU 的时间百分比)
- 内存信息：总内存大小(total)、空闲内存大小(free)、使用的内存大小(used)、作为缓冲的内存大小(buff/cache)
- 交换分区信息：交换分区总大小(total)、空闲交换分区大小(free)、使用的交互分区大小(used)

top 命令输出的进程占用的系统资源信息在每次刷新时会根据 CPU 的使用率进行排序，其显示内容和 ```ps aux``` 显示地类似：
- PID
- USER
- PR
- NI
- VIRI
- RES
- SHR
- S
- %CPU
- %MEM
- TIME+
- COMMAND

 top 命令还可以交互显示，在 top 命令的显示中可以使用交互的使用命令：
 - ```? 或 h```：显示交互模式的帮助
 - ```P```：以 CPU 使用率排序，默认是此排序
 - ```M```：以内存的使用率排序
 - ```N```：以 PID 排序
 - ```q```：退出 top

#### 启动进程

#### 查看进程树

#### 终止进程

### 磁盘 I/O 监控
使用 ```iotop``` 命令可以监控磁盘的 I/O 情况，显示磁盘整体的 I/O 以及进程的 I/O 信息。```iotop``` 命令有多个可选项


### 网络 IO 监控

			监控磁盘 I/O
				iotop
					iotop 具有与 top 相似的 UI，其中包括 PID，用户，I/O，进程等相关信息，可以很方便的查看进程是如何使用 IO
					语法：
						iotop [选项]
							选项：
								-o				只显示有 io 操作的进程
								-b				批量显示，无交互，主要用作记录到文件
								-n NUM			显示 NUM 次，主要用于非交互模式
								-d SEC			间隔 SEC 秒刷新一次
								-p PID			监控的进程 PID
								-u USER			监控的进程用户
			查看进程树
				pstree [选项]
					选项：
						-p			显示进程的PID
						-u			显示进程的所属用户
					最小安装时默认没有安装，yum -y install psmisc
		终止进程
			kill 命令
				kill -l			查看可用的进程信号
				
				信号代号	信号名称				说明
				---------------------------------------------------------------
					1		SIGHUP			该信号让进程立即关闭，然后重新读取配置文件之后重启
					2		SIGINT			程序终止信号，用于终止前台进程。相当于输出 Ctrl+c 快捷键
					8		SIGFPE			在发生致命的算数运算错误时发出，不仅包括浮点运算错误，还包括溢出及除数为0等其它所有的算术错误
					9		SIGKILL			用来立即结束程序的运行，本信号不能被阻塞、处理和忽略。一般用于强制终止进程
					14		SIGALRM			时钟定时信号，计算的是实际的时间或时钟时间。alarm 函数使用该信号
					15		SIGTERM			正常结束进程的信号，kill 命令的默认信号。有时如果进程已经发生问题，这个信号是无法正常终止进程的，我们才会尝试 sigkill 信号，也就是信号9
					18		SIGCONT			该信号可以让暂停的进程恢复执行，本信号不能被阻断
					19		SIGSTOP			该信号可以暂停前台进程，相当于输入 ctrl+z 快捷键。本信号不能被阻断
				
				kill -l 22354			重启进程
				kill -9 22368			强制杀死进程
			killall 命令
				killall [选项] [信号] 进程名		按照进程名杀死进程
					选项：
						-i			交互式，询问是否要杀死某个进程
						-I			忽略进程名的大小写
					killall -9 httpd
			pkill 命令
				pkill [选项] [信号] 进程名			按照进程名终止进程
					选项：
						-t 终端号		按照终端号踢出用户
					pkill -t -9 pts/1	强制杀死从 pts/1 虚拟终端登录的进程
	工作管理
		把进程放入后台
			在命令之后加上 & 就可以将该进程放入后台，后台还在运行，如果终端退出则命令终止
				tar -zcvf etc.tar.gz /etc/ &
				
				nohup 让进程永久执行，和终端没有关系，即使终端关闭依然不影响执行
					nohup command &		让命令永久在后台执行
				nohup 会产生日志文件 nohup.out，命令的输出会保存到这个文件中，一般在当前目录下，如果当前目录不可写，那么自动保存到执行这个命令的用户的 home 目录下
			在命令执行的过程中，按下 ctrl+z 快捷键，在后台暂停运行
		查看后台的工作
			jobs [-l]
				选项：
					-l			显示工作的 PID
			注意：+ 号代表最近一个放入后台的工作，也是工作恢复时默认恢复的工作，- 号代表倒数第二个放入后台的工作
		将后台暂停的工作恢复到前台执行
			fg %工作号
				参数：
					%工作号			%可以省略，但是注意工作号和PID的区别
		把后台暂停的工作恢复到后台执行
			bg %工作号
			注意：后台恢复执行的命令，是不能和前台有交互的，否则不能恢复到后台执行
	系统资源查看
		vmstat 命令监控系统资源
			vmstat [刷新延时 刷新次数]
				刷新延时以秒为单位
			vmstat 1 3
		dmesg 开机时内核检测信息
			dmesg | grep CPU		启动时 CPU 相关信息
			demsg | grep eth0		启动时的网卡信息
		free 命令查看内存使用状态
			free [-b|-k|-m|-g]
				选项：
					-b			以字节为单位显示
					-k			以KB为单位显示，默认就是以KB为单位显示
					-m			以MB为单位显示
					-g			以GB为单位显示
					-h			自动合理设置单位
			缓冲和缓存的区别：
				缓存(cache)是用来加速数据从硬盘“读取”的
				缓冲(buffer)是用来加速数据“写入”硬盘的
		查看 CUP 信息
			cat /proc/cpuinfo
		uptime 命令
			uptime			显示系统的启动时间和平均负载，也就是 top 命令的第一行。w 命令也可以看到这个数据
		查看系统与内核相关信息
			uname [选项]
				选项：
					-a		查看系统所有相关信息
					-r		查看内核版本
					-s		查看内核名称
			判断当前系统的位数
				linux 没有直接查看当前系统位数的命令，可以通过查询外部命令文件类型看到系统位数
				如：
					file /bin/ls
			查看当前 Linux 系统的发行版本
				lsb_release -a
		列出进程打开或使用的文件信息
			lsof [选项]		列出进程调用或打开的文件信息
				选项：
					-c 字符串		只列出以字符串开头的进程打开的文件
					-u 用户名		只列出某个用户的进程打开的文件
					-p pid			列出某个 PID 进程打开的文件
	系统定时任务
		crond 服务管理与访问控制
			service crond restart
			chkconfig crond on
		用户的 crontab 设置
			crontab [选项]
				选项：
					-e			编辑 crontab 定时任务
					-l			查询 crontab 任务
					-r			删除当前用户所有的 crontab 任务
			crontab -e		进入 crontab 编辑界面。会打开 vim 编辑工作
				格式：
					* * * * * 执行的任务
				----------------------------------------------
								含义				范围
				----------------------------------------------
				第一个*		一小时当中的第几分钟	0-59
				第二个*		一天当中的第几个小时	0-23
				第三个*		一个月当中的第几天		1-31
				第四个*		一年当中的第几个月		1-12
				第五个*		一周当中的星期几		0-7(0 和 7 都代表星期日)
				-----------------------------------------------
				特殊符号				含义
				------------------------------------------------
					*		代表任何时间。比如第一个 * 代表一小时中每分钟都执行一次的意思
					,		代表不连续的时间。比如 0 8,12,16 * * * 代表在每天的8点，12点，16点都执行一次命令
					-		代表连续的时间范围。比如 0 5 * * 1-6 代表在周一到周六的5点执行命令
					*/n		代表每隔多久执行一次。比如 */10 * * * * 代表每隔10分钟就执行一遍命令
				----------------------------------------------------
				
				*/5 * * * * /bin/echo "11" >> /tmp/test			每隔5分钟写入11到 /tmp/test
				5 5 * * 2 /sbin/shutdown -r now					每周二的5：05重启
				0,5,10 10 15 * * /root/sh/autobak.sh				每个月15日10点，10点5分，10点10分执行脚本
					
					#!/bin/bash
					date=$(date +\%y\%m\%d)
					size=$(du -sh /etc)
					
					echo "Date: $date" > /tmp/dbbak/dbinfo.txt
					echo "Date size: $size" >> /tmp/dbbak/dbinfo.txt
					cd /tmp/dbbak
					tar -zcf etc_$date.tar.gz /etc/ /tmp/dbbak/dbinfo.txt &> /dev/null
					rm -rf /tmp/dbbak/dbinfo.txt